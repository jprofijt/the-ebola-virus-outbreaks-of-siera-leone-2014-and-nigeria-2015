---
title: "Het Ebola virus"
author: "Rinze-Pieter Jonker & Jouke Profijt"
date: "June 1, 2018"
output: pdf_document
---

![Image of Ebola](Ebola.jpeg)


```{r setup, include=FALSE}
knitr::opts_chunk$set()
```

```{r, echo = F, message = F}
rm(list = ls())
library(deSolve)
library(pander)
```


\pagebreak

\tableofcontents

\pagebreak


# 1. Introduction


In this day and age the world is getting smaller and smaller. To get from europe to the united states it roughly takes 11 hours. This ease of travelling everywhere in the world within one day comes with one huge risk, the risk of spreading a dangerous infectious disease. On july 20, 2014 a infected passenger, with the Ebola virus disease (EVD), arrived in Nigeria. After a total of 20 cases where 8 died, Nigeria was cleared of the ebola virus on october 20, 2014 57 days. This shows what happens if 1 person is infected with ebola and begins to get in contact with others. Luckely by handeling fast not many people got infected with EVD because the authorities handeled quickly. Through our simulations we are trying to replicate the outbreak in Nigeria and see what can happen if there wasn't a quick response and we like to show if this outbreak was a abnormlity or simular to other outbreaks. Also we would like to compare the outbreak in Nigeria with other simular type of outbreaks and see if our parameters in the model are accurate for other EVD cases. [2]


The Ebola virus is a class IV RNA virus and the first time it was seen in 1976 in Sudan. 


\pagebreak

# 2. Materials & Methods

## 2.1. The Model

![schematic model for EVD infection spread. Susceptible induviduals *S* are infected by infectious individuals *I* at rate $\beta$. Then they go through a incubation period *E* at rate   $\sigma$. After incubation induviduals become infectious *I*. These infectious people either recover *R* or die *D* at rate $\gamma$. The fatality rate so how many people die or recover is given by *f*.](EVD_Model.png)


The model uses the following formula's:

* $B(t) = B0e^{(-k(time - t))}$
* $dS/dT = -B(t)SI$
* $dE/dT = B(t)SI - \sigma E$
* $dI/dT = \sigma E - yI$
* $dR/dT = (1-f)yI$
* $dD/dT = fyI$

The model itself is a rather simple SEIR (Susceptible-Exposed-Infecious-Recovered) model, as can be seen in figure 2. The people that are in the group of susceptible people *S* will move to the exposed group *E* after they get infected by the virus, if they are exposed to the virus they will go through a incubation period $\sigma$. After they went through the incubation period they will move to the infected group *I*. Here they will move trough the infectiousness period *y*. After this they will either move to the group recoverd people *R* or the group dead people *D*. This will be caculated by using the fatality rate *f*, in the case of ebola it is 0.39. The differential equations will be solved using the $ODE()$ function from deSolve, deSolve is a package in R. [1]


## 2.2. The data

The model was started with 10^6^ susceptible people *S*, 1 infected person *I* and no people that where exposed to him *E*. This was done because the case that was simulated was with one index case that could be traced. We also started with 0 dead people *D* and 0 recovered people R* because there cant be any dead people if there was nobody infected before the first day, this also goes for the recovered people. In the table below you can see the initial values of the model. [1]

\pagebreak

```{r, echo=F}
# time 57 dagen (4924800)
time <- seq(0,57,1)

# standaard parameters
st.para <- c(k = 0.19,
             f = 0.39,
             y =  0.71,
             sigma = 0.33,
             t = 3,
             Bo = 1.22*10^-6,
             e = 2.71828182459)

# standaard standaard waarden
st.state <- c(S = 10^6,
              E = 0,
              I = 1,
              R = 0,
              D = 0)

used.state <- data.frame(st.state)
colnames(used.state) <- c("Value")
used.state$Meaning <- c("Susceptible people",
                        "Exposed people",
                        "Infected people",
                        "Recovered people",
                        "Dead people")
pander(used.state, style = "grid", caption = "Standard initial values")
```

In the table below descirbes the parameters that where used. These parameters where based on the parameters used in the paper we are reviewing.


```{r, echo = F}
used.para <- data.frame(st.para)
colnames(used.para) <- c("Value")
used.para$Meaning <- c("Rate at wich the control measures reduce transmission",
                       "Fatality rate",
                       "Duration of incubation",
                       "Duration of infectiousness",
                       "Time at wich the control measures start to work",
                       "Transmission rate",
                       "Constante")
pander(used.para, style = "grid", caption = "Standard parmeters")
```

\pagebreak

```{r}
low.para <- st.para
low.para["k"] <- 0.1 #0.1
low.para["f"] <- 0.14
low.para["Bo"] <- 0.7*10^-6 # 0.7

high.para <- st.para
high.para["k"] <- 0.38 # 0.38
high.para["f"] <- 0.71
high.para["Bo"] <- 2.1*10^-6 # 2.1


ebola.model <- function(time, para, state){
    with(as.list(c(state, para)),{
        Bt <- Bo * e^( -k * (time - t))
        
        dS <- -Bt * S * I 
        dE <- Bt * S * I - sigma * E
        dI <- sigma * E - y * I
        dR <- (1 - f) * y * I
        dD <- f * y * I
        
        return(list(c(dS, dE, dI, dR, dD)))
    })
}



st.out <- as.data.frame(ode(y = st.state,
                            times = time,
                            parms = st.para,
                            func = ebola.model,
                            method = "euler"))

high.out <- as.data.frame(ode(y = st.state,
                              times = time,
                              parms = high.para,
                              func = ebola.model,
                            method = "euler"))

low.out <- as.data.frame(ode(y = st.state,
                             times = time,
                             parms = low.para,
                             func = ebola.model,
                            method = "euler"))



colnames(st.out) <- c("Time",
                      "S",
                      "E", 
                      "I",
                      "R",
                      "D")

colnames(high.out) <- c("Time",
                      "S",
                      "E", 
                      "I",
                      "R",
                      "D")

colnames(low.out) <- c("Time",
                      "S",
                      "E", 
                      "I",
                      "R",
                      "D")

round.out <- round(st.out)
```

\pagebreak

# 3. Results

```{r, echo = F}
# Susceptible people
plot(st.out$Time, st.out$S,
     type = "n",
     main = "amount of susceptible people over time",
     ylab = "Susceptible people",
     xlab = "Time in days",
     ylim = c(min(st.out$S) - 45, 10^6))
polygon(c(st.out$Time, rev(st.out$Time)), c(high.out$S, rev(low.out$S)),
        col = "red",
        lwd = 0.25,
        density = 20,
        border = NA)
lines(high.out$Time, high.out$S,
      col = "red",
      type = "l",
      lty = 2)
lines(low.out$Time, low.out$S,
      col = "red",
      type = "l",
      lty = 2)
lines(st.out$Time, st.out$S,
      lwd = 2)
legend("bottomright",
       c("Simulation", "Confidence intervals (95% - 5%)"),
       lty = c( 1, 2),
       col = c("black", "red"))
```

```{r, echo=F}
# Exposed people
plot(st.out$Time, st.out$E,
     type = "n",
     main = "Amount of exposed people over time",
     ylab = "Exposed people",
     xlab = "Time in days", 
     ylim = c(0, max(st.out$E) + 15))
polygon(c(st.out$Time, rev(st.out$Time)), c(high.out$E, rev(low.out$E)),
        col = "red",
        lwd = 0.25,
        density = 20,
        border = NA)
lines(high.out$Time, high.out$E,
      col = "red",
      type = "l",
      lty = 2)
lines(low.out$Time, low.out$E,
      col = "red",
      type = "l",
      lty = 2)
lines(st.out$Time, st.out$E,
      lwd = 2)
legend("topright",
       c("Simulation", "Confidence intervals (95% - 5%)"),
       lty = c( 1, 2),
       col = c("black", "red"))
```

```{r, echo=F}
# Infected people
plot(st.out$Time, st.out$I,
     type = "l",
     main = "Amount of infected people over time",
     ylab = "Infected people",
     xlab = "Time in days", 
     ylim = c(0, max(st.out$I) + 7))
polygon(c(st.out$Time, rev(st.out$Time)), c(high.out$I, rev(low.out$I)),
        col = "red",
        lwd = 0.25,
        density = 20,
        border = NA)
lines(high.out$Time, high.out$I,
      col = "red",
      type = "l",
      lty = 2)
lines(low.out$Time, low.out$I,
      col = "red",
      type = "l",
      lty = 2)
lines(st.out$Time, st.out$I,
      lwd = 2)
legend("topright",
       c("Simulation", "Confidence intervals (95% - 5%)"),
       lty = c( 1, 2),
       col = c("black", "red"))
```

```{r, echo=F}
# Recovered people
plot(st.out$Time, st.out$R,
     type = "n",
     main = "Amount of people that have recoverd over time",
     ylab = "Recovered people",
     xlab = "Time in days", 
     ylim = c(0, max(st.out$R) + 10))
polygon(c(st.out$Time, rev(st.out$Time)), c(high.out$R, rev(low.out$R)),
        col = "red",
        lwd = 0.25,
        density = 20,
        border = NA)
lines(high.out$Time, high.out$R,
      col = "red",
      type = "l",
      lty = 2)
lines(low.out$Time, low.out$R,
      col = "red",
      type = "l",
      lty = 2)
lines(st.out$Time, st.out$R,
      lwd = 2)
legend("topright",
       c("Simulation", "Confidence intervals (95% - 5%)"),
       lty = c( 1, 2),
       col = c("black", "red"))
```

```{r, echo=F}
# Dead people
plot(st.out$Time, st.out$D,
     type = "n",
     main = "Amount of dead people over time",
     ylab = "Dead people",
     xlab = "Time in days", 
     ylim = c(0, max(st.out$D) + 35))
polygon(c(st.out$Time, rev(st.out$Time)), c(high.out$D, rev(low.out$D)),
        col = "red",
        lwd = 0.25,
        density = 20,
        border = NA)
lines(high.out$Time, high.out$D,
      col = "red",
      type = "l",
      lty = 2)
lines(low.out$Time, low.out$D,
      col = "red",
      type = "l",
      lty = 2)
lines(st.out$Time, st.out$D,
      lwd = 2)
legend("topright",
       c("Simulation", "Confidence intervals (95% - 5%)"),
       lty = c( 1, 2),
       col = c("black", "red"))
```


```{r}
difference.by.day <- function(x, collumn){
  day.before <- as.numeric(subset(round.out,Time == x[1] - 1, select = collumn))
  diff <- x[collumn] - day.before
  if (is.na(diff)) {
      diff <- 0
  }
  return(diff)
  
}

difference.by.day.norm <- function(x, collumn){
  day.before <- as.numeric(subset(st.out,Time == x[1] - 1, select = collumn))
  diff <- x[collumn] - day.before
  if (is.na(diff)){
      diff <- 0
  }
  return(diff)
}

diffrence.infections <- function(x){
  collumns <- c("I", "R", "D")
  total.cases.before <- sum(as.numeric(subset(st.out,
                                              Time == x[1] - 1,
                                              select = collumns)))
  
  total.cases.after <- sum(as.numeric(subset(st.out,
                                             Time == x[1],
                                             select = collumns)))
  diffrence <- total.cases.after - total.cases.before
  
  return(diffrence)
  
}

difference.dead.norm <- apply(st.out, 1, difference.by.day.norm, "D")

difference.recovered <- apply(round.out, 1, difference.by.day, "R")
difference.dead <- apply(round.out, 1, difference.by.day, "D")

daily.new.cases <- apply(st.out, 1, diffrence.infections)

```

```{r, echo=F}
# plot(time, difference.susceptible,
#      pch = 16)
# 
# plot(time, difference.exposed,
#      pch = 16)
# 
# plot(time, difference.infected,
#      pch = 16)

plot(time, difference.recovered,
     main = "amount of recovered people per day",
     ylab = "recovered",
     xlab = "day",
     pch = 0)
```

```{r, echo=F}

plot(time, difference.dead,
     main = "amount of deceased per day",
     ylab = "deceased",
     xlab = "day",
     pch = 0)
```

```{r, echo=F}

plot(time, daily.new.cases,
     main = "New cases per day",
     ylab = "Cases",
     xlab = "time",
     type = "l")
```

```{r}
ebola_data <- read.csv("Data/previous-case-counts.csv", header = T, sep = ";")
ebola_data.sorted <- ebola_data[order(as.Date(ebola_data$WHO.report.date, format = "%d-%m-%Y")),]
asdate <- function(x) {
  date2 <- as.Date(as.character(x), format="%d-%m-%Y")
  return(date2)
}
get.timestamp <- function(x) {
  dates <- lapply(ebola_data.sorted$WHO.report.date, asdate)
  date1 <- as.Date(as.character(x[1]), format="%d-%m-%Y")
  index <- match(date1, dates)
  startdate <- as.Date(as.character(ebola_data.sorted[index - 1,]$WHO.report.date), format="%d-%m-%Y")
  date.diff <- date1-startdate
  return(as.numeric(date.diff))
  
}

time.st <- apply(ebola_data.sorted, 1, get.timestamp)
time.st[1] <- 0
time.st <- head(time.st, -1)
procces.time <- function(x) {
  for 
}

```

\pagebreak

# 4. Conclusie & Discussie

\pagebreak

# Bronnen

1. Althaus, C. L., Low, N., Musa, E. O., Shuaib, F., & Gsteiger, S. (2015, 21 april). Ebola virus disease outbreak in Nigeria: Transmission dynamics and rapid control. Retrieved from [https://www.sciencedirect.com/science/article/pii/S1755436515000341](https://www.sciencedirect.com/science/article/pii/S1755436515000341) on 01-06-2018

2. Wikipedia, Ebolavirus. (2018, 29 mei). Retrieved from [https://en.wikipedia.org/wiki/Ebolavirus](https://en.wikipedia.org/wiki/Ebolavirus), on 10-06-2018

\pagebreak

# aantekeningen verslag
 * let op de bronnen, zorg ervoor dat er geen plagiaat is
 
introductie
    eerste paragraaf
        introductie onderwerp, intresse krijgen
        geeft context en probleem, welk probleem wil je oplossen
        wat is het doel
        
    volgende paragraven
        achtergrond van het onderwerp
        context, zie de paper/onderzoek. wat is hier al gedaan
        Historie van model (evt.)
        Problemen
        -> Studie
    
    Indeling Verslag

Methoden
    Waar komt data/model vandaan
    Model beschrijven visueel (inkscape, draw.oi, dia) & formules (niet als plaatjes)
    inline formule is met #$, formule appart is met dubbel
    aanpak/ variatie
    Analyse
    hier moeten ook nog de programma's in de je gebruikt("we doen analyse met R")(veel programma's met versie erbij in een apparte tabel)
    
Resultaten

Conclusie/Discussie

Bronnen

suplementing ding
appendix


jafta stomp